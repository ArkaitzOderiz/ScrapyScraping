\chapter[Datos]{Datos}
\label{Chap3}

Para este proyecto disponemos de los siguientes datos obtenidos de distintas páginas web:
\begin{itemize}
	\item Nivel (m)
	\item Caudal ($m^3/s$)
	\item Precipitación (mm)
	\item Temperatura (ºC)
	\item Humedad (\%)
	\item Radiación ($W/m^2$)
\end{itemize}
A su vez, dispondremos de la fecha y hora en la que se hicieron la lectura de los datos, junto con los códigos y coordenadas de las estaciones sobre las cuales obtenemos los datos.

\section{Aemet}
La Agencia Estatal de Meteorología (AEMET) es el Servicio Meteorológico Nacional y Autoridad Meteorológica del Estado, siendo su objetivo es la monitorización y predicción de fenómenos meteorológicos.
\newline
\newline
AEMET dispone de una API de obtención de datos llamada AEMET OpenData la cual no usaremos pues muchos de los datos que se obtienen de esta manera no nos son útiles.
\newline
\newline
Como se ve en la imagen \ref{fig:ej3}, dentro de la web podemos encontrar de forma accesible múltiples datos relacionados con la meteorología tomados cada hora, de los cuales seleccionaremos únicamente temperatura, precipitación y humedad, puesto que los datos relacionados con el viento o la presión atmosférica no son tan relevantes para este proyecto.

\begin{figure} [h!]
	\centering
	\includegraphics[width=0.7\textwidth]{fig/Aemet.png}
	\caption[Página Aemet de la estación en Aranguren (Navarra)]{Página Aemet}
	\label{fig:ej3}
\end{figure}

\section{El Agua en Navarra}
En esta página encontraremos los datos tanto del nivel de los ríos como de su caudal en los últimos 15 días en periodos de 10 minutos, siendo una de las fuentes principales de datos.
\newline
\newline
La sección de aforos en la página \ref{fig:ej4} muestra un mapa de Navarra y esta estructurada en 6 regiones, Norte, Arga, Ega, Ebro alto, Ebro bajo y Aragón, accediendo a cada región nos aparece el mapa de la región dándonos acceso a todas las estaciones en la zona.
\newline
\newline
Una vez dentro de la estación tendremos la posibilidad de observar los datos, primeramente en forma de gráfica y en caso de quererlo en forma numérica, pero no se puede acceder a los datos numéricos sin antes haber visitado la versión gráfica \ref{fig:ej5}.
\newline
\newline
Debido a este problema, para la obtención de los datos primero cargamos la web gráfica y le pasamos un script JavaScript para pulsar el botón que finalmente nos da acceso a los datos deseados.

\begin{figure} [h!]
	\centering
	\includegraphics[width=0.7\textwidth]{fig/AguaEnNavarra.png}
	\caption[Página principal de aforos de El Agua en Navarra]{Página El Agua en Navarra}
	\label{fig:ej4}
\end{figure}

\begin{figure} [h!]
	\centering
	\includegraphics[width=0.7\textwidth]{fig/ErrorAguaEnNavarra.png}
	\caption[Error al cargar directamente la página de datos numéricos en El Agua en Navarra]{Error datos numéricos en El Agua en Navarra}
	\label{fig:ej5}
\end{figure}

\section{MeteoNavarra}
En la página de meteorología y climatología de Navarra encontramos una gran sección de estaciones de las cuales poder obtener datos.
\newline
\newline
De entre los dos tipos e estaciones disponibles, automática y manual, únicamente tomamos los datos de las estaciones automáticas, esto se debe a que las manuales solo proveen datos diarios de la temperatura máxima, mínima y de la precipitación acumulada. Esto hace que no dispongamos de ningún dato hasta que finalice el día, cosa que no es viable si lo que se propone es predecir cambios radicales en un periodo de tiempo reducido.
\newline
\newline
Las estaciones automáticas proporcionan tanto datos en periodos de diez minutos como datos diarios, siguiendo el mismo razonamiento que con las estaciones manuales no tomamos los datos diarios y, entre los actualizados cada diez minutos tomamos la temperatura, humedad relativa, radiación global y precipitación en un periodo de dos días.

\begin{figure} [h!]
	\centering
	\includegraphics[width=0.7\textwidth]{fig/DatosMeteoNavarra.png}
	\caption[Apartado selección de datos MeteoNavarra]{Datos MeteoNavarra}
	\label{fig:ej6}
\end{figure}

\section{Creación de la Base de Datos}

\subsection{Preparación de entorno}
Partiendo de una instalación limpia de Debian primero instalaremos el entorno virtual sobre el que trabajar, para ello ejecutaremos los siguientes comandos:

Instalamos las depandencias
sudo apt install python3-venv python3-dev

Creamos un nuevo directorio sobre el que trabajar
mkdir ~/dirdemiproyecto
cd ~/dirdemiproyecto

Creamos el entorno virtual
python3 -m venv envdemiproyecto

activamos el entorno virtual
source envdemiproyecto/bin/activate

una vez seguidos los pasos nuestra terminal debe mostrarse así:
(envdemiproyecto)user@host:~/dirdemiproyecto'$'
